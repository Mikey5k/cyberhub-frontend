rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    // === PUBLIC READ-ONLY COLLECTIONS ===
    
    // Services catalog - everyone can view
    match /services/{serviceId} {
      allow read: if true;
      allow write: if true; // Allow API to manage services
    }
    
    // Campaigns - marketing content
    match /campaigns/{campaignId} {
      allow read: if true;
      allow write: if true; // Allow API to manage campaigns
    }
    
    // === USER COLLECTIONS ===
    // Allow full access for user management via API
    
    match /users/{userId} {
      allow read, write: if true; // API-controlled
    }
    
    match /clients/{userId} {
      allow read, write: if true; // API-controlled
    }
    
    match /workers/{userId} {
      allow read, write: if true; // API-controlled
    }
    
    match /admins/{userId} {
      allow read, write: if true; // API-controlled
    }
    
    match /managers/{userId} {
      allow read, write: if true; // API-controlled
    }
    
    // === TASK SYSTEM ===
    
    match /tasks/{taskId} {
      allow read, write: if true; // Allow API to manage tasks
    }
    
    // Real-time chat within tasks
    match /tasks/{taskId}/messages/{messageId} {
      allow read, write: if true; // For real-time chat
    }
    
    // === FINANCIAL DATA ===
    
    match /commissions/{commissionId} {
      allow read, write: if true; // API-controlled
    }
    
    match /withdrawals/{withdrawalId} {
      allow read, write: if true; // API-controlled
    }
    
    match /transactions/{transactionId} {
      allow read, write: if true; // API-controlled
    }
    
    // === ANALYTICS & SUPPORT ===
    
    match /support/{ticketId} {
      allow read, write: if true; // API-controlled
    }
    
    match /analytics/{documentId} {
      allow read, write: if true; // API-controlled
    }
    
    // === DEFAULT: ALLOW EVERYTHING (API CONTROLLED) ===
    // Since we're using API key and server-side validation
    match /{document=**} {
      allow read, write: if true;
    }
  }
}